import bz2
import logging
import os
import pickle
import numpy
import csv

from collections import Counter
from operator import add
from numpy.lib.stride_tricks import as_strided

def create_dictionary():
    # Part I: Counting the words
    statuses =[]
    global_counter = Counter()
    with open('training_dict.csv', 'rb') as csvfile:
        tweets = csv.reader(csvfile)
        for row in tweets:
            statuses.append(row[0])

    for i in range(len(statuses)):
        line = statuses[i]
        line = line.lower()
        words = None
        words = line.strip().split(' ')
        global_counter.update(words)

    # Part II: Combining the counts
    combined_counter = global_counter

    # Part III: Creating the dictionary
    num_words = min(5003,len(combined_counter)+3)
    vocab_count = combined_counter.most_common(num_words - 3)
    vocab = {'UNK': 1, '<s>': 0, '</s>': 0,'LINK': 2}
    for i, (word, count) in enumerate(vocab_count):
        vocab[word] = i + 3
    return vocab

def save_obj(obj, name ):
    with open('obj/'+ name + '.pkl', 'wb') as f:
        pickle.dump(obj, f, pickle.HIGHEST_PROTOCOL)

def load_obj(name ):
    with open('obj/' + name + '.pkl', 'rb') as f:
        return pickle.load(f)

if __name__ == "__main__":
    vocab = create_dictionary()
    save_obj(vocab,'vocab')